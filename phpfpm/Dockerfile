FROM php:fpm-jessie

LABEL MAINTAINER Jordan Wamser<jwamser@redpandacoding.com>

ENV ENABLE_XDEBUG=0

# install php 72
RUN apt-get update
RUN apt-get install -y  apt-transport-https lsb-release ca-certificates
# wget
# RUN wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg
# RUN echo "deb https://packages.sury.org/php/ $(lsb_release -sc) main" | tee /etc/apt/sources.list.d/php.list
# RUN apt-get update
RUN apt-get install -y php-pear
# php7.2 php7.2-fpm 
RUN pecl channel-update pecl.php.net

RUN apt-get install -y curl
RUN curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add - && \
curl https://packages.microsoft.com/config/debian/8/prod.list > /etc/apt/sources.list.d/mssql-release.list

RUN apt-get update
RUN ACCEPT_EULA=Y apt-get install -y msodbcsql mssql-tools
# RUN ACCEPT_EULA=Y apt-get install mssql-tools
# RUN echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bash_profile
# RUN echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bashrc
# RUN source ~/.bashrc
# # optional: for unixODBC development headers
RUN apt-get install -y unixodbc-dev

RUN pear config-set php_ini `php --ini | grep "Loaded Configuration" | sed -e "s|.*:\s*||"` system

RUN pecl install sqlsrv && \
pecl install pdo_sqlsrv

COPY ./ini/php.ini /usr/local/etc/php/php.ini

RUN echo extension=sqlsrv.so > /usr/local/etc/php/conf.d/sqlsrv.ini
RUN echo extension=pdo_sqlsrv.so > /usr/local/etc/php/conf.d/pdo_sqlsrv.ini

# Install XDebug
RUN if [ "${ENABLE_XDEBUG}" -eq "1" ]; then \
        pecl install xdebug-2.5.0 \
            && docker-php-ext-enable xdebug \
            && echo "xdebug.idekey = PHPSTORM" >> /usr/local/etc/php/conf.d/xdebug.ini \
            && echo "xdebug.default_enable = 1" >> /usr/local/etc/php/conf.d/xdebug.ini \
            && echo "xdebug.remote_enable = 1" >> /usr/local/etc/php/conf.d/xdebug.ini \
            && echo "xdebug.remote_autostart = 1" >> /usr/local/etc/php/conf.d/xdebug.ini \
            && echo "xdebug.remote_connect_back = 0" >> /usr/local/etc/php/conf.d/xdebug.ini \
            && echo "xdebug.profiler_enable = 1" >> /usr/local/etc/php/conf.d/xdebug.ini \
            && echo "xdebug.remote_host = docker.for.mac.localhost" >> /usr/local/etc/php/conf.d/xdebug.ini \
    ;fi

# EXPOSE 8080
# WORKDIR /app
# CMD ["php", "-S", "0.0.0.0:8080"]

# RUN ln -s /usr/bin/php-fpm7.2 /bin/php-fpm

# RUN useradd -ms /bin/bash web
# USER web

# ENTRYPOINT ["/usr/bin"]
##<autogenerated>##
# CMD ["bash"]
##</autogenerated>##

